function loadJSON(b,a){var c=new XMLHttpRequest;c.overrideMimeType("application/json");c.open("GET",b,!0);c.onreadystatechange=function(){4==c.readyState&&"200"==c.status&&a(c.responseText)};c.send(null)}function inside(b,a){for(var c=b[0],e=b[1],d=!1,f=0,g=a.length-1;f<a.length;g=f++){var m=a[f][0],l=a[f][1],h=a[g][0],g=a[g][1];l>e!=g>e&&c<(h-m)*(e-l)/(g-l)+m&&(d=!d)}return d}
CanvasRenderingContext2D.prototype._roundRect=function(b,a,c,e,d,f,g){if(0!==d&&1!==d){"undefined"==typeof g&&(g=!0);"undefined"===typeof d&&(d=5);if("number"===typeof d)d={tl:d,tr:d,br:d,bl:d};else{var m={tl:0,tr:0,br:0,bl:0},l;for(l in m)d[l]=d[l]||m[l]}this.beginPath();this.moveTo(b+d.tl,a);this.lineTo(b+c-d.tr,a);this.quadraticCurveTo(b+c,a,b+c,a+d.tr);this.lineTo(b+c,a+e-d.br);this.quadraticCurveTo(b+c,a+e,b+c-d.br,a+e);this.lineTo(b+d.bl,a+e);this.quadraticCurveTo(b,a+e,b,a+e-d.bl);this.lineTo(b,
a+d.tl);this.quadraticCurveTo(b,a,b+d.tl,a);this.closePath();f&&this.fill();g&&this.stroke()}else this.rect(b,a,c,e),this.fill(),this.stroke()};CanvasRenderingContext2D.prototype._roundPoly=function(b,a){for(var c=b.data.shape,e=null,d=null,f=0;f<c.length;f++)switch(e=c[f].x,d=c[f].y,c[f]["function"]){case "moveTo":this.moveTo(parseInt(b.startX+e),parseInt(b.startY+d));break;case "lineTo":this.lineTo(parseInt(b.startX+e),parseInt(b.startY+d))}this.stroke();this.fill()};
CanvasRenderingContext2D._customShape=function(b){for(var a=b.data.customShape,c=0;c<a.length;c++){var e=a[c]["function"],d=a[c].x,f=a[c].y;"moveTo"===e&&this.moveTo(parseInt(b.startX+d),parseInt(b.startY+f));"lineTo"===e&&this.lineTo(parseInt(b.startX+d),parseInt(b.startY+f))}this.stroke();this.fill()};
(function(){function b(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");e.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return e}b.prototype=window.Event.prototype;window.CustomEvent=b})();var idKeyboardCount=0;
function Keyboard(b,a,c,e){var d=b.getBoundingClientRect();this.id=idKeyboardCount++;this.layout=a.layout||"keyboards/qwerty_uk.json";this.canvas=b;this.context=b.getContext("2d");this.keyWidth=a.keyWidth||40;this.keyHeight=a.keyHeight||40;this.offsetX=parseInt(d.left)||0;this.offsetY=parseInt(d.top)||0;this.defaultCursor=a.defaultCursor||"auto";this.hoverCursor=a.hoverCursor||"pointer";this.disabledCursor=a.disabledCursor||"auto";this.backgroundColor=a.backgroundColor||b.style.backgroundColor||"white";
this.keyBorderColor=a.keyBorderColor||"gray";this.keyBorderWidth=parseInt(a.keyBorderWidth)||1;this.keyBorderRadius=parseInt(a.keyBorderRadius)||0;this.keyBackgroundColor=a.keyBackgroundColor||"black";this.keyFontType=a.keyFontType||"25px Calibri";this.keyFontColor=a.keyFontColor||"gray";this.keyHoverBorderColor=a.keyHoverBorderColor||"white";this.keyHoverBorderWidth=a.keyHoverBorderWidth||this.keyBorderWidth;this.keyHoverBorderRadius=a.keyHoverBorderRadius||this.keyBorderRadius;this.keyHoverBackgroundColor=
a.keyHoverBackgroundColor||this.keyBackgroundColor;this.keyHoverFontType=a.keyHoverFontType||this.keyFontType;this.keyHoverFontColor=a.keyHoverFontColor||this.keyFontColor;this.keySelectedBorderColor=a.keySelectedBorderColor||"#3FB55E";this.keySelectedBorderWidth=a.keySelectedBorderWidth||this.keyBorderWidth;this.keySelectedBorderRadius=a.keySelectedBorderRadius||this.keyBorderRadius;this.keySelectedBackgroundColor=a.keySelectedBackgroundColor||this.keyBackgroundColor;this.keySelectedFontType=a.keySelectedFontType||
this.keyFontType;this.keySelectedFontColor=a.keySelectedFontColor||this.keyFontColor;this.keySelectedHoverBorderColor=a.keySelectedHoverBorderColor||this.keySelectedBorderColor;this.keySelectedHoverBorderWidth=a.keySelectedHoverBorderWidth||this.keySelectedBorderWidth;this.keySelectedHoverBorderRadius=a.keySelectedHoverBorderRadius||this.keyBorderRadius;this.keySelectedHoverBackgroundColor=a.keySelectedHoverBackgroundColor||this.keySelectedBackgroundColor;this.keySelectedHoverFontType=a.keySelectedHoverFontType||
this.keySelectedFontType;this.keySelectedHoverFontColor=a.keySelectedHoverFontColor||this.keySelectedFontColor;this.keyActiveBackgroundColor=a.keyActiveBackgroundColor||"rgb(22, 160, 133)";this.debug=c||!1;this.mouseClick={x:null,y:null};this.lines=e||[];this.selectedKey={};this.canvas.style.backgroundColor=this.backgroundColor}Keyboard.prototype.pushLine=function(b){this.lines.push(b)};
Keyboard.prototype.handleMouseDown=function(b){for(var a=0;a<this.lines.length;a++)for(var c=parseInt(b.clientX-this.offsetX+this.lines[a].startX+window.pageXOffset),e=parseInt(b.clientY-this.offsetY+this.lines[a].startY+window.pageYOffset),d=0;d<this.lines[a].keys.length;d++)this.lines[a].keys[d].isPointInside(c-this.lines[a].startX,e-this.lines[a].startY)&&!this.lines[a].keys[d].disabled&&(this.mouseClick.x=c,this.mouseClick.y=e,this.debug&&console.log(this.lines[a].keys[d].content),this.selectedKey===
this.lines[a].keys[d]?(this.selectedKey.selected=!1,this.selectedKey={}):(this.selectedKey.selected=!1,this.selectedKey=this.lines[a].keys[d],this.selectedKey.selected=!0),this.canvas.dispatchEvent(new CustomEvent("keyClick",{detail:{selectedKey:this.selectedKey,e:b}})))};
Keyboard.prototype.handleMouseHover=function(b){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a={hover:!1},c=0;c<this.lines.length;c++)for(var e=parseInt(b.clientX-this.offsetX+this.lines[c].startX+window.pageXOffset),d=parseInt(b.clientY-this.offsetY+this.lines[c].startY+window.pageYOffset),f=0;f<this.lines[c].keys.length;f++)this.lines[c].keys[f].isPointInside(e-this.lines[c].startX,d-this.lines[c].startY)?e!==this.mouseClick.x||d!==this.mouseClick.y?a={hover:!0,i:c,j:f}:
this.lines[c].keys[f].reDraw():this.lines[c].keys[f].reDraw();this.debug&&console.log(a);a.hover?(b=this.lines[a.i].keys[a.j],b.disabled?(this.canvas.style.cursor=this.disabledCursor,b.draw()):(this.canvas.style.cursor=this.hoverCursor,b.hover()),this.debug&&console.log(this.lines[c].keys[f].content)):this.canvas.style.cursor=this.defaultCursor};
Keyboard.prototype.init=function(){var b={},a=this;loadJSON(a.layout,function(c){b=JSON.parse(c);for(var e=c=0,d=0;d<b.rows.length;d++){c+=b.rows[d].startX;var e=e+b.rows[d].startY,f=0,g=new Line(a,c,e,b.rows[d].spaceX,b.rows[d].spaceY);a.debug&&console.group();a.debug&&console.log(g);for(var m=0,l=0,h=0;h<=b.rows[d].keys.length;h++)var k=b.rows[d].keys[h],f=h===b.rows[d].keys.length?f+g.spaceX:void 0!==k.data?f+(a.keyWidth*(k.data.widthFactor||1)+g.spaceX):f+(a.keyWidth+g.spaceX);console.log(f);
for(f=0;f<b.rows[d].keys.length;f++){var k=b.rows[d].keys[f],h=a.keyWidth,n=a.keyHeight,q=0,p=0;if("standard"!==(k.type||"standard"))switch(k.type){default:q=g.startX+m+f*g.spaceX+f*h,p=g.startY+l+d*g.spaceY+d*n,m+=h*(k.data.widthFactor||1)-h,l+=n*(k.data.heightFactor||1)-n,h*=k.data.widthFactor||1,n*=k.data.heightFactor||1}else q=g.startX+m+f*g.spaceX+f*h,p=g.startY+l+d*g.spaceY+d*n;p=g.startY+d*g.spaceY+d*n;k=new Key(g,q,p,h,n,k.content,k.type||"standard",k.data);a.debug&&console.log(k)}a.debug&&
console.groupEnd()}a.canvas.addEventListener("click",function(b){a.handleMouseDown(b)});a.canvas.addEventListener("mousemove",function(b){a.handleMouseHover(b)})})};Keyboard.prototype.reDraw=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var b=0;b<this.lines.length;b++)for(var a=0;a<this.lines[b].keys.length;a++)this.lines[b].keys[a].draw()};Keyboard.prototype.resizeCanvas=function(b,a){this.canvas.width=b;this.canvas.height=a;this.context=this.canvas.getContext("2d")};var idLineCount=0;function Line(b,a,c,e,d,f){this.id=idLineCount++;this.context=b.context;this.startX=a;this.startY=c;this.spaceX=e;this.spaceY=d;this.keys=f||[];this.keyboard=b;b.pushLine(this)}Line.prototype.pushKey=function(b){this.keys.push(b)};Line.prototype.dot=function(){this.context.beginPath();this.context.strokeStyle="red";this.context.rect(this.startX,this.startY,1,1);this.context.stroke()};var idKeyCount=0;function Key(b,a,c,e,d,f,g,m){this.id=idKeyCount++;this.startX=a;this.startY=c;this.lengthX=e;this.lengthY=d;this.content=f||"";this.type=g||"standard";this.data=m||{};this.line=b;this.active=this.selected=!1;this.disabled=this.data.disabled||!1;b.pushKey(this);this.draw()}Key.prototype.reDraw=function(b,a){this.startX=b||this.startX;this.startY=a||this.startY;this.draw(this.selected?this.line.keyboard.keySelectedBorderColor:this.line.keyboard.keyBorderColor);return this};
Key.prototype.hover=function(b,a){this.startX=b||this.startX;this.startY=a||this.startY;this.draw(this.selected?this.line.keyboard.keySelectedHoverBorderColor:this.line.keyboard.keyHoverBorderColor,!0)};
Key.prototype.draw=function(b,a){a=a||!1;var c=this.line.context,e=this.startX+this.lengthX/2,d=c.measureText("I").width+this.startY+this.lengthY/2,f=a?this.selected?this.line.keyboard.keySelectedHoverBorderRadius:this.line.keyboard.keyHoverBorderRadius:this.selected?this.line.keyboard.keySelectedBorderRadius:this.line.keyboard.keyBorderRadius;c.save();c.beginPath();this.disabled&&(c.globalAlpha=.5);c.fillStyle=a?this.selected?this.line.keyboard.keySelectedHoverBackgroundColor:this.active?this.line.keyboard.keyActiveBackgroundColor:
this.line.keyboard.keyHoverBackgroundColor:this.selected?this.line.keyboard.keySelectedBackgroundColor:this.active?this.line.keyboard.keyActiveBackgroundColor:this.line.keyboard.keyBackgroundColor;c.strokeStyle=b||(this.selected?this.line.keyboard.keySelectedBorderColor:this.line.keyboard.keyBorderColor);c.lineWidth=a?this.selected?this.line.keyboard.keySelectedHoverBorderWidth:this.line.keyboard.keyHoverBorderWidth:this.selected?this.line.keyboard.keySelectedBorderWidth:this.line.keyboard.keyBorderWidth;
"custom"===this.type?(e=this.startX+this.data.customWidth/2||e,d=this.startX+this.data.customHeight/2||d):("square"===this.type&&(this.lengthX=this.data.customWidth||this.lengthX,this.lengthY=this.data.customHeight||this.lengthY,e=this.startX+this.lengthX/2||e,d=c.measureText("I").width+this.startY+this.lengthY/2),c._roundRect(this.startX,this.startY,this.lengthX,this.lengthY,parseInt(f),!0,!0));c.font=a?this.selected?this.line.keyboard.keySelectedHoverFontType:this.line.keyboard.keyHoverFontType:
this.selected?this.line.keyboard.keySelectedFontType:this.line.keyboard.keyFontType;c.textAlign="center";c.fillStyle=a?this.selected?this.line.keyboard.keySelectedHoverFontColor:this.line.keyboard.keyHoverFontColor:this.selected?this.line.keyboard.keySelectedFontColor:this.line.keyboard.keyFontColor;c.fillText(this.content,e,d);c.restore()};
Key.prototype.isPointInside=function(b,a){if("custom"===this.type){for(var c=[],e=0;e<this.data.customShape.length;e++)"lineTo"===this.data.customShape[e]["function"]&&c.push([parseInt(this.data.customShape[e].x+this.startX),parseInt(this.data.customShape[e].y+this.startY)]);return inside([b,a],c)}c=b>=this.startX&&b<=this.startX+this.lengthX&&a>=this.startY&&a<=this.startY+this.lengthY;this.line.keyboard.debug&&console.log(c+" | mouseX: "+b+" | mouseY: "+a+" | keyX: "+this.startX+" | keyY: "+this.startY);
return c};Key.prototype.getValue=function(){return void 0!==this.data.value?this.data.value:this.content};
